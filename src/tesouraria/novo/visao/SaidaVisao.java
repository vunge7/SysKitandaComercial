/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package tesouraria.novo.visao;


import java.sql.Connection;
import entity.Compras;
import entity.Contas;
import entity.ExtratoContaFornecedor;
import comercial.controller.ExtratoContaFornecedorController;
import comercial.controller.ComprasController;
import comercial.controller.DocumentosController;
import java.math.BigDecimal;
import java.math.RoundingMode;
import java.util.Date;
import java.util.HashMap;
import javax.swing.DefaultComboBoxModel;
import javax.swing.JOptionPane;
import kitanda.util.CfMethods;
import tesouraria.novo.controller.ContaController;
import tesouraria.novo.controller.ContaMovimentosController;
import tesouraria.novo.controller.ContaOperacaoController;
import tesouraria.novo.util.AnyReport;
import util.BDConexao;
import util.DVML;
import visao.FornecedorOutroVisao;

/**
 *
 * @author Domingos Dala Vunge
 */
public class SaidaVisao extends javax.swing.JFrame
{

    private ContaController ccc;
    private ContaMovimentosController cmc;
    private ExtratoContaFornecedorController ecfc;
    private ComprasController comprasController;
    private ContaOperacaoController coc;
    private Contas conta;
    private BDConexao conexao;
    private int idFornecedor;
    private Compras compra;
    private String documento;

    public SaidaVisao( Compras compra, int idFornecedor, String documento, double total, BDConexao conexao )
    {
        initComponents();
        setLocationRelativeTo( null );
        this.conexao = conexao;
        this.idFornecedor = idFornecedor;
        this.compra = compra;
        this.documento = documento;
        ccc = new ContaController( conexao );
        cmc = new ContaMovimentosController( conexao );
        ecfc = new ExtratoContaFornecedorController( conexao );
        comprasController = new ComprasController( conexao );
        coc = new ContaOperacaoController( conexao );
        txtDocumento.setText( documento );
        lbTotal.setText( CfMethods.formatarComoMoeda( total ) );
        cmbContas.setModel( new DefaultComboBoxModel<>( ccc.getVector() ) );
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents()
    {

        jLabel1 = new javax.swing.JLabel();
        jPanel1 = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        jLabel7 = new javax.swing.JLabel();
        jTextField1 = new javax.swing.JTextField();
        jLabel8 = new javax.swing.JLabel();
        cmbContas = new javax.swing.JComboBox<>();
        jScrollPane1 = new javax.swing.JScrollPane();
        txtDescricao = new javax.swing.JTextArea();
        jButton1 = new javax.swing.JButton();
        jPanel2 = new javax.swing.JPanel();
        jLabel10 = new javax.swing.JLabel();
        txtDocumento = new javax.swing.JTextField();
        jLabel11 = new javax.swing.JLabel();
        lbTotal = new javax.swing.JLabel();
        jLabel9 = new javax.swing.JLabel();
        lbSaldoActual = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        txtValor = new javax.swing.JTextField();
        jButton2 = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);

        jLabel1.setBackground(new java.awt.Color(0, 0, 102));
        jLabel1.setFont(new java.awt.Font("Segoe UI", 1, 24)); // NOI18N
        jLabel1.setForeground(new java.awt.Color(255, 255, 255));
        jLabel1.setText("TESOURARIA/SAIDA");
        jLabel1.setOpaque(true);

        jLabel2.setText("Descrição");

        jLabel7.setText("Número");

        jLabel8.setText("Saldo actual");

        cmbContas.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        cmbContas.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                cmbContasActionPerformed(evt);
            }
        });

        txtDescricao.setColumns(20);
        txtDescricao.setRows(5);
        jScrollPane1.setViewportView(txtDescricao);

        jButton1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagens/img32x32/_ok.png"))); // NOI18N
        jButton1.setText("Registrar");
        jButton1.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                jButton1ActionPerformed(evt);
            }
        });

        jLabel10.setText("Documento:");

        txtDocumento.setEditable(false);
        txtDocumento.setFont(new java.awt.Font("Segoe UI", 1, 24)); // NOI18N
        txtDocumento.setHorizontalAlignment(javax.swing.JTextField.RIGHT);

        jLabel11.setText("Total a Pagar");

        lbTotal.setFont(new java.awt.Font("Segoe UI", 0, 36)); // NOI18N
        lbTotal.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lbTotal.setText("0");

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel2Layout.createSequentialGroup()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addGap(0, 139, Short.MAX_VALUE)
                        .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel11)
                            .addComponent(jLabel10, javax.swing.GroupLayout.PREFERRED_SIZE, 108, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(lbTotal, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(txtDocumento, javax.swing.GroupLayout.DEFAULT_SIZE, 241, Short.MAX_VALUE))))
                .addContainerGap())
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addComponent(jLabel10, javax.swing.GroupLayout.PREFERRED_SIZE, 35, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(txtDocumento, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jLabel11, javax.swing.GroupLayout.PREFERRED_SIZE, 35, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(lbTotal, javax.swing.GroupLayout.PREFERRED_SIZE, 35, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 16, Short.MAX_VALUE))
        );

        jLabel9.setText("Conta");

        lbSaldoActual.setFont(new java.awt.Font("Segoe UI", 0, 36)); // NOI18N
        lbSaldoActual.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        lbSaldoActual.setText("0");

        jLabel3.setText("Valor:");

        jButton2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagens/SAIR/sair_verde_32x32.png"))); // NOI18N
        jButton2.setText("Sair");
        jButton2.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                jButton2ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(14, 14, 14)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel3)
                    .addComponent(txtValor, javax.swing.GroupLayout.PREFERRED_SIZE, 254, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(0, 0, Short.MAX_VALUE))
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(jLabel7)
                        .addGap(37, 37, 37)
                        .addComponent(jLabel9, javax.swing.GroupLayout.PREFERRED_SIZE, 272, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(lbSaldoActual, javax.swing.GroupLayout.PREFERRED_SIZE, 297, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel2)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 415, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                            .addComponent(jTextField1, javax.swing.GroupLayout.DEFAULT_SIZE, 108, Short.MAX_VALUE)
                            .addComponent(jLabel8, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(cmbContas, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jButton1)
                .addGap(54, 54, 54)
                .addComponent(jButton2)
                .addGap(25, 25, 25))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel7)
                            .addComponent(jLabel9))
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jTextField1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(cmbContas, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jLabel8)
                        .addGap(5, 5, 5)
                        .addComponent(lbSaldoActual, javax.swing.GroupLayout.PREFERRED_SIZE, 35, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jLabel2)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 65, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addGap(25, 25, 25)
                .addComponent(jLabel3)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(txtValor, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jButton1)
                    .addComponent(jButton2))
                .addContainerGap(11, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jLabel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGap(14, 14, 14))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 68, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_jButton1ActionPerformed
    {//GEN-HEADEREND:event_jButton1ActionPerformed
        // TODO add your handling code here:

        int opcao = JOptionPane.showConfirmDialog( null, "Deseja continuar o processo?" );
        double valor = Double.parseDouble( txtValor.getText() );
        if ( JOptionPane.YES_OPTION == opcao )
        {

            Double saldoActual = CfMethods.parseMoedaFormatada( lbSaldoActual.getText() );

            if ( valor > saldoActual )
            {
                int opcao1 = JOptionPane.showConfirmDialog( null, "Valor superior ao da conta.\nDeseja continuar?\nNota: Se continuar o saldo tornará negativo" );

                if ( JOptionPane.YES_OPTION == opcao1 )
                {
                    procedimentoSaida( txtDescricao.getText(), Double.parseDouble( txtValor.getText() ), conta );
                    mostrarDocumento();
                }
            }
            else
            {
                procedimentoSaida( txtDescricao.getText(), Double.parseDouble( txtValor.getText() ), conta );
                mostrarDocumento();

            }

        }

    }//GEN-LAST:event_jButton1ActionPerformed

    private void cmbContasActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_cmbContasActionPerformed
    {//GEN-HEADEREND:event_cmbContasActionPerformed
        // TODO add your handling code here:
        String toString = cmbContas.getSelectedItem().toString();
        conta = ccc.getContasByDesignacao( toString );
        lbSaldoActual.setText( CfMethods.formatarComoMoeda( conta.getSaldo() ) );


    }//GEN-LAST:event_cmbContasActionPerformed

    private void jButton2ActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_jButton2ActionPerformed
    {//GEN-HEADEREND:event_jButton2ActionPerformed
        dispose();
    }//GEN-LAST:event_jButton2ActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main( String args[] )
    {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try
        {
            for ( javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels() )
            {
                if ( "Nimbus".equals( info.getName() ) )
                {
                    javax.swing.UIManager.setLookAndFeel( info.getClassName() );
                    break;
                }
            }
        }
        catch ( ClassNotFoundException ex )
        {
            java.util.logging.Logger.getLogger( SaidaVisao.class.getName() ).log( java.util.logging.Level.SEVERE, null, ex );
        }
        catch ( InstantiationException ex )
        {
            java.util.logging.Logger.getLogger( SaidaVisao.class.getName() ).log( java.util.logging.Level.SEVERE, null, ex );
        }
        catch ( IllegalAccessException ex )
        {
            java.util.logging.Logger.getLogger( SaidaVisao.class.getName() ).log( java.util.logging.Level.SEVERE, null, ex );
        }
        catch ( javax.swing.UnsupportedLookAndFeelException ex )
        {
            java.util.logging.Logger.getLogger( SaidaVisao.class.getName() ).log( java.util.logging.Level.SEVERE, null, ex );
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater( new Runnable()
        {
            public void run()
            {
                new SaidaVisao( null, 1, "", 0d, BDConexao.getInstancia() ).setVisible( true );
            }
        } );
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    public static javax.swing.JComboBox<String> cmbContas;
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton2;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTextField jTextField1;
    private javax.swing.JLabel lbSaldoActual;
    private javax.swing.JLabel lbTotal;
    private javax.swing.JTextArea txtDescricao;
    private javax.swing.JTextField txtDocumento;
    private javax.swing.JTextField txtValor;
    // End of variables declaration//GEN-END:variables

    private boolean registrarMovExtratoFornecedor()
    {
        ExtratoContaFornecedor extratoContaFornecedor = new ExtratoContaFornecedor();

        BigDecimal saldo_anterior = ecfc.getSaldoActualByIdFornecedor( idFornecedor ); // o saldo anterior é o saldo actual anterior ao movimento
        BigDecimal debito;
        BigDecimal credito;
        BigDecimal saldo_actual;
        String tipo_extrato = "DB";
        String fornecedor_nome = "";
        String user_name = "N/A";
        int user_id = 15;

        debito = new BigDecimal( txtValor.getText() ).setScale( 2, RoundingMode.CEILING );
        credito = new BigDecimal( 0.00 );
        saldo_actual = saldo_anterior.subtract( debito );
        extratoContaFornecedor.setSaldoActual( saldo_actual.setScale( 2, RoundingMode.CEILING ) );

        extratoContaFornecedor.setDocumento( txtDocumento.getText() );
        extratoContaFornecedor.setReferencia( "" );
        extratoContaFornecedor.setDescricao( txtDescricao.getText() );
        extratoContaFornecedor.setDataHora( new Date() );
        extratoContaFornecedor.setSaldoAnterior( saldo_anterior );
        extratoContaFornecedor.setDebito( debito );
        extratoContaFornecedor.setCredito( credito );
        extratoContaFornecedor.setSaldoActual( saldo_actual );
        extratoContaFornecedor.setTipoExtrato( tipo_extrato );
        extratoContaFornecedor.setFonecedorNome( fornecedor_nome );
        extratoContaFornecedor.setFornecedorId( idFornecedor );
        extratoContaFornecedor.setUserName( user_name );
        extratoContaFornecedor.setUserId( user_id );

        return ecfc.salvar( extratoContaFornecedor );

    }

    private void procedimentoSaida( String descricao, double valor, Contas contaLocal )
    {

        BigDecimal ValorDecimal = new BigDecimal( valor );
        boolean procedimentoSaidaContas = cmc.procedimentoSaidaContas( contaLocal, txtDocumento.getText(),
                ValorDecimal, descricao, "Saida", 0, "N/A", "N/A", conexao );

        if ( procedimentoSaidaContas )
        {
            if ( registrarMovExtratoFornecedor() )
            {
                if ( comprasController.actualizarValores( compra.getCodFact(), new BigDecimal( txtValor.getText() ), compra.getValorPago(), compra.getValorPorPagar() ) )
                {
                    DocumentosController.commit( conexao );
                    JOptionPane.showMessageDialog( null, "Movimento registrado com sucesso" );
                    FornecedorOutroVisao.mostrarSaldoFornecedor();
                    FornecedorOutroVisao.mostrarContaCorrenteFornecedor();
                    FornecedorOutroVisao.adicionar_compras();
                    dispose();
                }
                else
                {
                    DocumentosController.rollback( conexao );
                    JOptionPane.showMessageDialog( null, "Falha ao registrar a saida.", "Falha", JOptionPane.ERROR_MESSAGE );
                }

            }
            else
            {
                DocumentosController.rollback( conexao );
                JOptionPane.showMessageDialog( null, "Falha ao registrar a saida.", "Falha", JOptionPane.ERROR_MESSAGE );
            }
        }
//        DocumentosController.startTransaction( conexao );
//        ContaMovimentos contaMovimentos = new ContaMovimentos();
//
//        contaMovimentos.setContaDesignacao( contaLocal.getDesignacao() );
//        contaMovimentos.setContaId( contaLocal.getPkContas() );
//        contaMovimentos.setDataHora( new Date() );
//        contaMovimentos.setDescricao( descricao );
//        contaMovimentos.setDocumento( "n/a" );
//        contaMovimentos.setSaldoAnterior( contaLocal.getSaldo() );
//        contaMovimentos.setValorEntrada( BigDecimal.ZERO );
//        contaMovimentos.setValorSaida( new BigDecimal( valor ) );
//        contaMovimentos.setSaldoFinal( contaLocal.getSaldo().subtract( contaMovimentos.getValorSaida() ) );
//        contaMovimentos.setTipo( "Saida" );
//
//        if ( cmc.salvar( contaMovimentos ) && ccc.actualizarSaldo( contaLocal.getPkContas(), contaMovimentos.getSaldoFinal() ) )
//        {
//            if ( registrarMovExtratoFornecedor() )
//            {
//                if ( comprasController.actualizarValores( compra.getCodFact(), new BigDecimal( txtValor.getText() ), compra.getValorPago(), compra.getValorPorPagar() ) )
//                {
//                    DocumentosController.commitTransaction( conexao );
//                    JOptionPane.showMessageDialog( null, "Movimento registrado com sucesso" );
//                    dispose();
//                }
//                else
//                {
//                    DocumentosController.rollback( conexao );
//                    JOptionPane.showMessageDialog( null, "Falha ao registrar a saida.", "Falha", JOptionPane.ERROR_MESSAGE );
//                }
//
//            }
//            else
//            {
//                DocumentosController.rollback( conexao );
//                JOptionPane.showMessageDialog( null, "Falha ao registrar a saida.", "Falha", JOptionPane.ERROR_MESSAGE );
//            }
//
//        }
//        else
//        {
//            DocumentosController.rollback( conexao );
//            JOptionPane.showMessageDialog( null, "Falha ao registrar a saida.", "Falha", JOptionPane.ERROR_MESSAGE );
//        }
//
    }

    private void mostrarDocumento()
    {
        long LAST_ID = coc.getLastID();
        double valor = Double.parseDouble( txtValor.getText() );
        String docNumero = documento.split( " " )[ 1 ];

        HashMap hashMap1 = new HashMap();
        System.out.println( "COD_OPERACAO: " + LAST_ID );
        hashMap1.put( "COD_OPERACAO", LAST_ID );
        hashMap1.put( "STATUS_DOCUMENTO", "Original" );
        hashMap1.put( "VALOR_ENTREGUE", new BigDecimal( valor ) );
        hashMap1.put( "DOC_NUMERO", docNumero );
        hashMap1.put( "COD_FORNECEDOR", idFornecedor );
        new AnyReport( hashMap1, "fr_nota_pagamento.jasper" );

        HashMap hashMap2 = new HashMap();
        System.out.println( "COD_OPERACAO: " + LAST_ID );
        hashMap2.put( "COD_OPERACAO", LAST_ID );
        hashMap2.put( "STATUS_DOCUMENTO", DVML.SEGUNDA_VIA_CONFORMIDADE_COM_ORIGINAL );
        hashMap2.put( "VALOR_ENTREGUE", new BigDecimal( valor ) );
        hashMap2.put( "DOC_NUMERO", docNumero );
        hashMap2.put( "COD_FORNECEDOR", idFornecedor );
        new AnyReport( hashMap2, "fr_nota_pagamento.jasper" );
    }
}
