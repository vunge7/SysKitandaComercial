/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package visao;


import java.sql.Connection;
import comercial.controller.AnoEconomicoController;
import comercial.controller.ClientesController;
import comercial.controller.DadosInstituicaoController;
import comercial.controller.DetalhesDocumentoController;
import comercial.controller.DocumentosController;
import comercial.controller.VendasController;
import controller.DadoInstituicaoController;
import dao.VendaDao;
import entity.AnoEconomico;
import entity.Cambio;
import entity.DetalhesDocumento;
import entity.Documento;
import entity.TbArmazem;
import entity.TbBanco;
import entity.TbCliente;
import entity.TbUsuario;
import entity.TbVenda;
import java.math.BigDecimal;
import java.util.Calendar;
import java.util.Date;
import java.util.HashMap;
import java.util.Objects;
import javax.persistence.EntityManagerFactory;
import javax.swing.DefaultComboBoxModel;
import javax.swing.JCheckBox;
import javax.swing.JOptionPane;
import tesouraria.novo.util.AnyReport;
import util.BDConexao;
import util.DVML;
import util.JPAEntityMannagerFactoryUtil;
import util.MetodosUtil;

/**
 *
 * @author Domingos Dala Vunge
 */
public class VistoriaVisao extends javax.swing.JFrame
{
    private static EntityManagerFactory emf = JPAEntityMannagerFactoryUtil.em;
    private DetalhesDocumentoController dc;
    private DadosInstituicaoController dadosInstituicaoController;
    private AnoEconomicoController anoEconomicoController;
    private VendasController vendasController;
    private ClientesController cc;
    private BDConexao conexao, conexaoTransaction;
    private final int idUser;
    private TbVenda venda;
    private DetalhesDocumento detalhesDocumento;
    private DocumentosController documentosController;
    private TbCliente cliente;
    private Documento documento;
    private AnoEconomico anoEconomico;
    private int doc_prox_cod;
    private String prox_doc;
    private static String codFactura = "";

    public VistoriaVisao( int idUser, BDConexao conexao )
    {
        initComponents();
        setLocationRelativeTo( null );
        this.idUser = idUser;
        this.conexao = conexao;
        dc = new DetalhesDocumentoController( conexao );
        dadosInstituicaoController = new DadosInstituicaoController( conexao );
        anoEconomicoController = new AnoEconomicoController( conexao );
        documentosController = new DocumentosController( conexao );

        vendasController = new VendasController( conexao );
        cc = new ClientesController( conexao );
        cmbAnoEconomico.setModel( new DefaultComboBoxModel( anoEconomicoController.getVector() ) );
        mostrar_proximo_codigo_documento();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings( "unchecked" )
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents()
    {

        jPanel1 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        jPanel12 = new javax.swing.JPanel();
        lbCliente = new javax.swing.JLabel();
        txtRef = new javax.swing.JTextField();
        lbTelefone = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        cmbAnoEconomico = new javax.swing.JComboBox<>();
        painelImagem = new javax.swing.JPanel();
        jPanel2 = new javax.swing.JPanel();
        jPanel3 = new javax.swing.JPanel();
        ckArCondicionado = new javax.swing.JCheckBox();
        ckBateria = new javax.swing.JCheckBox();
        ckCanicos = new javax.swing.JCheckBox();
        ckCamera = new javax.swing.JCheckBox();
        ckColete = new javax.swing.JCheckBox();
        ckCintoSeguranca = new javax.swing.JCheckBox();
        ckChaveRoda = new javax.swing.JCheckBox();
        jPanel8 = new javax.swing.JPanel();
        ckElevador = new javax.swing.JCheckBox();
        ckExtintor = new javax.swing.JCheckBox();
        ckGuincho = new javax.swing.JCheckBox();
        ckFarois = new javax.swing.JCheckBox();
        ckLivrete = new javax.swing.JCheckBox();
        ckLimpaParaBrisa = new javax.swing.JCheckBox();
        ckIsqueiro = new javax.swing.JCheckBox();
        jPanel5 = new javax.swing.JPanel();
        ckLongos = new javax.swing.JCheckBox();
        ckMacaco = new javax.swing.JCheckBox();
        ckManipuloInt = new javax.swing.JCheckBox();
        ckManipoExt = new javax.swing.JCheckBox();
        ckPainel = new javax.swing.JCheckBox();
        ckTitulo = new javax.swing.JCheckBox();
        ckPiscas = new javax.swing.JCheckBox();
        jPanel7 = new javax.swing.JPanel();
        ckPorcasJantes = new javax.swing.JCheckBox();
        ckPresenca = new javax.swing.JCheckBox();
        ckRadio = new javax.swing.JCheckBox();
        ckSensor = new javax.swing.JCheckBox();
        ckRefletores = new javax.swing.JCheckBox();
        ckSobressalente = new javax.swing.JCheckBox();
        ckRetrovisores = new javax.swing.JCheckBox();
        jPanel4 = new javax.swing.JPanel();
        ckStop = new javax.swing.JCheckBox();
        ckTampasJantes = new javax.swing.JCheckBox();
        ckTampoes = new javax.swing.JCheckBox();
        ckTapetes = new javax.swing.JCheckBox();
        ckTejadilho = new javax.swing.JCheckBox();
        ckTriangulo = new javax.swing.JCheckBox();
        ckVidros = new javax.swing.JCheckBox();
        jPanel6 = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        txtNotas = new javax.swing.JTextArea();
        jPanel9 = new javax.swing.JPanel();
        jPanel10 = new javax.swing.JPanel();
        jPanel11 = new javax.swing.JPanel();
        jButton1 = new javax.swing.JButton();
        jButton3 = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("Vistoria de Viatura");

        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder(""));

        jLabel1.setBackground(new java.awt.Color(0, 51, 102));
        jLabel1.setFont(new java.awt.Font("Segoe UI", 1, 36)); // NOI18N
        jLabel1.setForeground(new java.awt.Color(255, 255, 255));
        jLabel1.setText("VISTORIA DE VIATURA:  VIS 2024/001");
        jLabel1.setOpaque(true);

        jPanel12.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        lbCliente.setFont(new java.awt.Font("Segoe UI", 3, 20)); // NOI18N
        lbCliente.setText("Cliente:");
        jPanel12.add(lbCliente, new org.netbeans.lib.awtextra.AbsoluteConstraints(100, 60, 320, 20));

        txtRef.setFont(new java.awt.Font("Segoe UI", 1, 20)); // NOI18N
        txtRef.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                txtRefActionPerformed(evt);
            }
        });
        jPanel12.add(txtRef, new org.netbeans.lib.awtextra.AbsoluteConstraints(100, 10, 230, 38));

        lbTelefone.setFont(new java.awt.Font("Segoe UI", 3, 20)); // NOI18N
        lbTelefone.setText("Telefone");
        jPanel12.add(lbTelefone, new org.netbeans.lib.awtextra.AbsoluteConstraints(100, 90, 350, 20));

        jLabel4.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel4.setText("Cliente:");
        jPanel12.add(jLabel4, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 60, 80, 20));

        jLabel5.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel5.setText("Ref. Doc:");
        jPanel12.add(jLabel5, new org.netbeans.lib.awtextra.AbsoluteConstraints(6, 6, 80, 41));

        jLabel6.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel6.setText("Telefone:");
        jPanel12.add(jLabel6, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 90, 80, 20));

        cmbAnoEconomico.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        cmbAnoEconomico.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                cmbAnoEconomicoActionPerformed(evt);
            }
        });
        jPanel12.add(cmbAnoEconomico, new org.netbeans.lib.awtextra.AbsoluteConstraints(340, 10, 110, 40));

        javax.swing.GroupLayout painelImagemLayout = new javax.swing.GroupLayout(painelImagem);
        painelImagem.setLayout(painelImagemLayout);
        painelImagemLayout.setHorizontalGroup(
            painelImagemLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 0, Short.MAX_VALUE)
        );
        painelImagemLayout.setVerticalGroup(
            painelImagemLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 0, Short.MAX_VALUE)
        );

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(jPanel12, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(painelImagem, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                .addContainerGap())
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 78, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(painelImagem, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel12, javax.swing.GroupLayout.DEFAULT_SIZE, 127, Short.MAX_VALUE))
                .addContainerGap())
        );

        jPanel2.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Dados do Veículo", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Segoe UI", 1, 18))); // NOI18N
        jPanel2.setLayout(new java.awt.GridLayout(1, 5));

        jPanel3.setLayout(new java.awt.GridLayout(7, 1));

        ckArCondicionado.setText("Ar Condicionado");
        ckArCondicionado.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckArCondicionadoActionPerformed(evt);
            }
        });
        jPanel3.add(ckArCondicionado);

        ckBateria.setText("Bateria");
        jPanel3.add(ckBateria);

        ckCanicos.setText("Caniços");
        jPanel3.add(ckCanicos);

        ckCamera.setText("Câmera");
        jPanel3.add(ckCamera);

        ckColete.setText("Colete");
        jPanel3.add(ckColete);

        ckCintoSeguranca.setText("Cinto de Segurança");
        jPanel3.add(ckCintoSeguranca);

        ckChaveRoda.setText("Chave de Roda");
        ckChaveRoda.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckChaveRodaActionPerformed(evt);
            }
        });
        jPanel3.add(ckChaveRoda);

        jPanel2.add(jPanel3);

        jPanel8.setLayout(new java.awt.GridLayout(7, 1));

        ckElevador.setText("Elevador");
        jPanel8.add(ckElevador);

        ckExtintor.setText("Extintor");
        ckExtintor.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckExtintorActionPerformed(evt);
            }
        });
        jPanel8.add(ckExtintor);

        ckGuincho.setText("Guincho");
        ckGuincho.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckGuinchoActionPerformed(evt);
            }
        });
        jPanel8.add(ckGuincho);

        ckFarois.setText("Faróis");
        ckFarois.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckFaroisActionPerformed(evt);
            }
        });
        jPanel8.add(ckFarois);

        ckLivrete.setText("Livrete");
        ckLivrete.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckLivreteActionPerformed(evt);
            }
        });
        jPanel8.add(ckLivrete);

        ckLimpaParaBrisa.setText("Limpa Pára-Brisa");
        ckLimpaParaBrisa.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckLimpaParaBrisaActionPerformed(evt);
            }
        });
        jPanel8.add(ckLimpaParaBrisa);

        ckIsqueiro.setText("Isqueiro");
        ckIsqueiro.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckIsqueiroActionPerformed(evt);
            }
        });
        jPanel8.add(ckIsqueiro);

        jPanel2.add(jPanel8);

        jPanel5.setLayout(new java.awt.GridLayout(7, 1));

        ckLongos.setText("Longos");
        ckLongos.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckLongosActionPerformed(evt);
            }
        });
        jPanel5.add(ckLongos);

        ckMacaco.setText("Macaco");
        ckMacaco.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckMacacoActionPerformed(evt);
            }
        });
        jPanel5.add(ckMacaco);

        ckManipuloInt.setText("Manipulo Int.");
        ckManipuloInt.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckManipuloIntActionPerformed(evt);
            }
        });
        jPanel5.add(ckManipuloInt);

        ckManipoExt.setText("Manipulo Ext.");
        ckManipoExt.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckManipoExtActionPerformed(evt);
            }
        });
        jPanel5.add(ckManipoExt);

        ckPainel.setText("Painel");
        ckPainel.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckPainelActionPerformed(evt);
            }
        });
        jPanel5.add(ckPainel);

        ckTitulo.setText("Título");
        ckTitulo.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckTituloActionPerformed(evt);
            }
        });
        jPanel5.add(ckTitulo);

        ckPiscas.setText("Piscas");
        ckPiscas.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckPiscasActionPerformed(evt);
            }
        });
        jPanel5.add(ckPiscas);

        jPanel2.add(jPanel5);

        jPanel7.setLayout(new java.awt.GridLayout(7, 1));

        ckPorcasJantes.setText("Porcas Jantes");
        ckPorcasJantes.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckPorcasJantesActionPerformed(evt);
            }
        });
        jPanel7.add(ckPorcasJantes);

        ckPresenca.setText("Presença");
        ckPresenca.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckPresencaActionPerformed(evt);
            }
        });
        jPanel7.add(ckPresenca);

        ckRadio.setText("Rádio");
        ckRadio.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckRadioActionPerformed(evt);
            }
        });
        jPanel7.add(ckRadio);

        ckSensor.setText("Sensor");
        ckSensor.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckSensorActionPerformed(evt);
            }
        });
        jPanel7.add(ckSensor);

        ckRefletores.setText("Reflectores");
        ckRefletores.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckRefletoresActionPerformed(evt);
            }
        });
        jPanel7.add(ckRefletores);

        ckSobressalente.setText("Sobressalente");
        ckSobressalente.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckSobressalenteActionPerformed(evt);
            }
        });
        jPanel7.add(ckSobressalente);

        ckRetrovisores.setText("Retrovisores");
        ckRetrovisores.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckRetrovisoresActionPerformed(evt);
            }
        });
        jPanel7.add(ckRetrovisores);

        jPanel2.add(jPanel7);

        jPanel4.setLayout(new java.awt.GridLayout(7, 1));

        ckStop.setText("Stop");
        ckStop.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckStopActionPerformed(evt);
            }
        });
        jPanel4.add(ckStop);

        ckTampasJantes.setText("Tampas Jantes");
        ckTampasJantes.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckTampasJantesActionPerformed(evt);
            }
        });
        jPanel4.add(ckTampasJantes);

        ckTampoes.setText("Tampões");
        ckTampoes.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckTampoesActionPerformed(evt);
            }
        });
        jPanel4.add(ckTampoes);

        ckTapetes.setText("Tapetes");
        ckTapetes.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckTapetesActionPerformed(evt);
            }
        });
        jPanel4.add(ckTapetes);

        ckTejadilho.setText("Tejadilho");
        ckTejadilho.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckTejadilhoActionPerformed(evt);
            }
        });
        jPanel4.add(ckTejadilho);

        ckTriangulo.setText("Triângulo");
        ckTriangulo.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckTrianguloActionPerformed(evt);
            }
        });
        jPanel4.add(ckTriangulo);

        ckVidros.setText("Vídros");
        ckVidros.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                ckVidrosActionPerformed(evt);
            }
        });
        jPanel4.add(ckVidros);

        jPanel2.add(jPanel4);

        jPanel6.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Notas", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Segoe UI", 1, 18))); // NOI18N

        txtNotas.setColumns(20);
        txtNotas.setRows(5);
        jScrollPane1.setViewportView(txtNotas);

        javax.swing.GroupLayout jPanel6Layout = new javax.swing.GroupLayout(jPanel6);
        jPanel6.setLayout(jPanel6Layout);
        jPanel6Layout.setHorizontalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jScrollPane1))
        );
        jPanel6Layout.setVerticalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 181, javax.swing.GroupLayout.PREFERRED_SIZE)
        );

        jPanel9.setLayout(new java.awt.GridLayout(1, 4));

        javax.swing.GroupLayout jPanel10Layout = new javax.swing.GroupLayout(jPanel10);
        jPanel10.setLayout(jPanel10Layout);
        jPanel10Layout.setHorizontalGroup(
            jPanel10Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 246, Short.MAX_VALUE)
        );
        jPanel10Layout.setVerticalGroup(
            jPanel10Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 58, Short.MAX_VALUE)
        );

        jPanel9.add(jPanel10);

        javax.swing.GroupLayout jPanel11Layout = new javax.swing.GroupLayout(jPanel11);
        jPanel11.setLayout(jPanel11Layout);
        jPanel11Layout.setHorizontalGroup(
            jPanel11Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 246, Short.MAX_VALUE)
        );
        jPanel11Layout.setVerticalGroup(
            jPanel11Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 58, Short.MAX_VALUE)
        );

        jPanel9.add(jPanel11);

        jButton1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagens/6665_32x32.png"))); // NOI18N
        jButton1.setText("Registrar");
        jButton1.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                jButton1ActionPerformed(evt);
            }
        });
        jPanel9.add(jButton1);

        jButton3.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagens/LOGOUT - VERMELHO/Logout 32x32.png"))); // NOI18N
        jButton3.setText("Sair");
        jButton3.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                jButton3ActionPerformed(evt);
            }
        });
        jPanel9.add(jButton3);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(jPanel9, javax.swing.GroupLayout.DEFAULT_SIZE, 987, Short.MAX_VALUE)
            .addComponent(jPanel6, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(jPanel2, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel6, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 26, Short.MAX_VALUE)
                .addComponent(jPanel9, javax.swing.GroupLayout.PREFERRED_SIZE, 58, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void ckChaveRodaActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckChaveRodaActionPerformed
    {//GEN-HEADEREND:event_ckChaveRodaActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckChaveRodaActionPerformed

    private void ckTejadilhoActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckTejadilhoActionPerformed
    {//GEN-HEADEREND:event_ckTejadilhoActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckTejadilhoActionPerformed

    private void ckTampasJantesActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckTampasJantesActionPerformed
    {//GEN-HEADEREND:event_ckTampasJantesActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckTampasJantesActionPerformed

    private void ckTampoesActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckTampoesActionPerformed
    {//GEN-HEADEREND:event_ckTampoesActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckTampoesActionPerformed

    private void ckTapetesActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckTapetesActionPerformed
    {//GEN-HEADEREND:event_ckTapetesActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckTapetesActionPerformed

    private void ckTrianguloActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckTrianguloActionPerformed
    {//GEN-HEADEREND:event_ckTrianguloActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckTrianguloActionPerformed

    private void ckVidrosActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckVidrosActionPerformed
    {//GEN-HEADEREND:event_ckVidrosActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckVidrosActionPerformed

    private void ckMacacoActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckMacacoActionPerformed
    {//GEN-HEADEREND:event_ckMacacoActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckMacacoActionPerformed

    private void ckManipuloIntActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckManipuloIntActionPerformed
    {//GEN-HEADEREND:event_ckManipuloIntActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckManipuloIntActionPerformed

    private void ckManipoExtActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckManipoExtActionPerformed
    {//GEN-HEADEREND:event_ckManipoExtActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckManipoExtActionPerformed

    private void ckPiscasActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckPiscasActionPerformed
    {//GEN-HEADEREND:event_ckPiscasActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckPiscasActionPerformed

    private void ckPainelActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckPainelActionPerformed
    {//GEN-HEADEREND:event_ckPainelActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckPainelActionPerformed

    private void ckLongosActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckLongosActionPerformed
    {//GEN-HEADEREND:event_ckLongosActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckLongosActionPerformed

    private void ckTituloActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckTituloActionPerformed
    {//GEN-HEADEREND:event_ckTituloActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckTituloActionPerformed

    private void ckPresencaActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckPresencaActionPerformed
    {//GEN-HEADEREND:event_ckPresencaActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckPresencaActionPerformed

    private void ckRadioActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckRadioActionPerformed
    {//GEN-HEADEREND:event_ckRadioActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckRadioActionPerformed

    private void ckSensorActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckSensorActionPerformed
    {//GEN-HEADEREND:event_ckSensorActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckSensorActionPerformed

    private void ckRefletoresActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckRefletoresActionPerformed
    {//GEN-HEADEREND:event_ckRefletoresActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckRefletoresActionPerformed

    private void ckSobressalenteActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckSobressalenteActionPerformed
    {//GEN-HEADEREND:event_ckSobressalenteActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckSobressalenteActionPerformed

    private void ckPorcasJantesActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckPorcasJantesActionPerformed
    {//GEN-HEADEREND:event_ckPorcasJantesActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckPorcasJantesActionPerformed

    private void ckRetrovisoresActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckRetrovisoresActionPerformed
    {//GEN-HEADEREND:event_ckRetrovisoresActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckRetrovisoresActionPerformed

    private void ckExtintorActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckExtintorActionPerformed
    {//GEN-HEADEREND:event_ckExtintorActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckExtintorActionPerformed

    private void ckGuinchoActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckGuinchoActionPerformed
    {//GEN-HEADEREND:event_ckGuinchoActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckGuinchoActionPerformed

    private void ckFaroisActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckFaroisActionPerformed
    {//GEN-HEADEREND:event_ckFaroisActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckFaroisActionPerformed

    private void ckLivreteActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckLivreteActionPerformed
    {//GEN-HEADEREND:event_ckLivreteActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckLivreteActionPerformed

    private void ckLimpaParaBrisaActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckLimpaParaBrisaActionPerformed
    {//GEN-HEADEREND:event_ckLimpaParaBrisaActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckLimpaParaBrisaActionPerformed

    private void ckIsqueiroActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckIsqueiroActionPerformed
    {//GEN-HEADEREND:event_ckIsqueiroActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckIsqueiroActionPerformed

    private void ckArCondicionadoActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckArCondicionadoActionPerformed
    {//GEN-HEADEREND:event_ckArCondicionadoActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckArCondicionadoActionPerformed

    private void ckStopActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_ckStopActionPerformed
    {//GEN-HEADEREND:event_ckStopActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckStopActionPerformed

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_jButton1ActionPerformed
    {//GEN-HEADEREND:event_jButton1ActionPerformed
        // TODO add your handling code here:
        procRegistrar();
    }//GEN-LAST:event_jButton1ActionPerformed

    private void jButton3ActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_jButton3ActionPerformed
    {//GEN-HEADEREND:event_jButton3ActionPerformed
        dispose();
    }//GEN-LAST:event_jButton3ActionPerformed

    private void txtRefActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_txtRefActionPerformed
    {//GEN-HEADEREND:event_txtRefActionPerformed
        // TODO add your handling code here:
        buscaDoc();
    }//GEN-LAST:event_txtRefActionPerformed

    private void cmbAnoEconomicoActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_cmbAnoEconomicoActionPerformed
    {//GEN-HEADEREND:event_cmbAnoEconomicoActionPerformed
        // TODO add your handling code here:
        mostrar_proximo_codigo_documento();
        //        actualizar_abreviacao();
    }//GEN-LAST:event_cmbAnoEconomicoActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main( String args[] )
    {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try
        {
            for ( javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels() )
            {
                if ( "Windows".equals( info.getName() ) )
                {
                    javax.swing.UIManager.setLookAndFeel( info.getClassName() );
                    break;
                }
            }
        }
        catch ( ClassNotFoundException ex )
        {
            java.util.logging.Logger.getLogger( VistoriaVisao.class.getName() ).log( java.util.logging.Level.SEVERE, null, ex );
        }
        catch ( InstantiationException ex )
        {
            java.util.logging.Logger.getLogger( VistoriaVisao.class.getName() ).log( java.util.logging.Level.SEVERE, null, ex );
        }
        catch ( IllegalAccessException ex )
        {
            java.util.logging.Logger.getLogger( VistoriaVisao.class.getName() ).log( java.util.logging.Level.SEVERE, null, ex );
        }
        catch ( javax.swing.UnsupportedLookAndFeelException ex )
        {
            java.util.logging.Logger.getLogger( VistoriaVisao.class.getName() ).log( java.util.logging.Level.SEVERE, null, ex );
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater( new Runnable()
        {
            public void run()
            {
                new VistoriaVisao( 15, BDConexao.getInstancia() ).setVisible( true );
            }
        } );
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JCheckBox ckArCondicionado;
    private javax.swing.JCheckBox ckBateria;
    private javax.swing.JCheckBox ckCamera;
    private javax.swing.JCheckBox ckCanicos;
    private javax.swing.JCheckBox ckChaveRoda;
    private javax.swing.JCheckBox ckCintoSeguranca;
    private javax.swing.JCheckBox ckColete;
    private javax.swing.JCheckBox ckElevador;
    private javax.swing.JCheckBox ckExtintor;
    private javax.swing.JCheckBox ckFarois;
    private javax.swing.JCheckBox ckGuincho;
    private javax.swing.JCheckBox ckIsqueiro;
    private javax.swing.JCheckBox ckLimpaParaBrisa;
    private javax.swing.JCheckBox ckLivrete;
    private javax.swing.JCheckBox ckLongos;
    private javax.swing.JCheckBox ckMacaco;
    private javax.swing.JCheckBox ckManipoExt;
    private javax.swing.JCheckBox ckManipuloInt;
    private javax.swing.JCheckBox ckPainel;
    private javax.swing.JCheckBox ckPiscas;
    private javax.swing.JCheckBox ckPorcasJantes;
    private javax.swing.JCheckBox ckPresenca;
    private javax.swing.JCheckBox ckRadio;
    private javax.swing.JCheckBox ckRefletores;
    private javax.swing.JCheckBox ckRetrovisores;
    private javax.swing.JCheckBox ckSensor;
    private javax.swing.JCheckBox ckSobressalente;
    private javax.swing.JCheckBox ckStop;
    private javax.swing.JCheckBox ckTampasJantes;
    private javax.swing.JCheckBox ckTampoes;
    private javax.swing.JCheckBox ckTapetes;
    private javax.swing.JCheckBox ckTejadilho;
    private javax.swing.JCheckBox ckTitulo;
    private javax.swing.JCheckBox ckTriangulo;
    private javax.swing.JCheckBox ckVidros;
    private static javax.swing.JComboBox<String> cmbAnoEconomico;
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton3;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel10;
    private javax.swing.JPanel jPanel11;
    private javax.swing.JPanel jPanel12;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JPanel jPanel7;
    private javax.swing.JPanel jPanel8;
    private javax.swing.JPanel jPanel9;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JLabel lbCliente;
    private javax.swing.JLabel lbTelefone;
    private javax.swing.JPanel painelImagem;
    private javax.swing.JTextArea txtNotas;
    private static javax.swing.JTextField txtRef;
    // End of variables declaration//GEN-END:variables

    private void procRegistrar()
    {

        int last_venda = salvar_venda_comercial();
        if ( last_venda > 0 )
        {
            detalhesDocumento = new DetalhesDocumento();
            prepararDetalhe( last_venda );
            if ( dc.salvar( detalhesDocumento ) )
            {
                JOptionPane.showMessageDialog( null, "Vistoria feita com sucesso!" );

                report( last_venda );
                mostrar_proximo_codigo_documento();
            }
            else
            {
                JOptionPane.showMessageDialog( null, "Falha ao registrar." );
            }
        }

    }

    private void buscaDoc()
    {
        String txtDocRef = txtRef.getText();

        venda = vendasController.getVendaByCodFact( txtDocRef );

        if ( Objects.nonNull( venda ) )
        {
            cliente = cc.findByCodigo( venda.getCodigoCliente().getCodigo() );
            lbCliente.setText( cliente.getNome() );
            lbTelefone.setText( cliente.getTelefone() );
        }
        else
        {
            lbCliente.setText( "" );
            lbTelefone.setText( "" );
        }

    }

    private void prepararDetalhe( int lastVenda )
    {

        detalhesDocumento.setArCondicionado( getSeleccionado( ckArCondicionado ) );
        detalhesDocumento.setBateria( getSeleccionado( ckBateria ) );
        detalhesDocumento.setCamara( getSeleccionado( ckCamera ) );
        detalhesDocumento.setCanicos( getSeleccionado( ckCanicos ) );
        detalhesDocumento.setChaveRoda( getSeleccionado( ckChaveRoda ) );
        detalhesDocumento.setCintoSeguranca( getSeleccionado( ckCintoSeguranca ) );
        detalhesDocumento.setColete( getSeleccionado( ckColete ) );
        detalhesDocumento.setElevador( getSeleccionado( ckElevador ) );
        detalhesDocumento.setExtintor( getSeleccionado( ckExtintor ) );
        detalhesDocumento.setFarois( getSeleccionado( ckFarois ) );
        detalhesDocumento.setGuincho( getSeleccionado( ckGuincho ) );
        detalhesDocumento.setIsqueiro( getSeleccionado( ckIsqueiro ) );
        detalhesDocumento.setLimpaParabrisa( getSeleccionado( ckLimpaParaBrisa ) );
        detalhesDocumento.setLivrete( getSeleccionado( ckLivrete ) );
        detalhesDocumento.setTitulo( getSeleccionado( ckTitulo ) );
        detalhesDocumento.setLongos( getSeleccionado( ckLongos ) );
        detalhesDocumento.setMacaco( getSeleccionado( ckMacaco ) );
        detalhesDocumento.setManipuloExt( getSeleccionado( ckManipoExt ) );
        detalhesDocumento.setManipuloInt( getSeleccionado( ckManipuloInt ) );
        detalhesDocumento.setPainel( getSeleccionado( ckPainel ) );
        detalhesDocumento.setPiscas( getSeleccionado( ckPiscas ) );
        detalhesDocumento.setPorcasJantes( getSeleccionado( ckPorcasJantes ) );
        detalhesDocumento.setRadio( getSeleccionado( ckRadio ) );
        detalhesDocumento.setReflectores( getSeleccionado( ckRefletores ) );
        detalhesDocumento.setRetrovisores( getSeleccionado( ckRetrovisores ) );
        detalhesDocumento.setSensor( getSeleccionado( ckSensor ) );
        detalhesDocumento.setSobresalente( getSeleccionado( ckSobressalente ) );
        detalhesDocumento.setStop( getSeleccionado( ckStop ) );
        detalhesDocumento.setTampasJantes( getSeleccionado( ckTampasJantes ) );
        detalhesDocumento.setTampoes( getSeleccionado( ckTampoes ) );
        detalhesDocumento.setTapetes( getSeleccionado( ckTapetes ) );
        detalhesDocumento.setTejadilho( getSeleccionado( ckTejadilho ) );
        detalhesDocumento.setTriangulo( getSeleccionado( ckTriangulo ) );
        detalhesDocumento.setVidros( getSeleccionado( ckVidros ) );
        detalhesDocumento.setPresenca(getSeleccionado( ckPresenca ) );
        detalhesDocumento.setCodVenda( lastVenda );
        detalhesDocumento.setDataEntrada( new Date() );
        detalhesDocumento.setNotas( txtNotas.getText() );

    }

    private String getSeleccionado( JCheckBox ck )
    {
        if ( ck.isSelected() )
        {
            return "V";
        }
        return "X";
    }

    private int salvar_venda_comercial()
    {
//        mostrar_proximo_codigo_documento();
        conexaoTransaction = BDConexao.getInstancia();

        DocumentosController.start( conexaoTransaction );
        int prazo_proforma = dadosInstituicaoController.findByCodigo( 1 ).getPrazoProforma();
        Date data_documento = new Date();
        TbVenda venda_local = new TbVenda();
        TbVenda venda_original = getVenda();
        venda_local.setDataVenda( data_documento );
        venda_local.setRefDataFact( data_documento );

        Calendar calendar = Calendar.getInstance();
        calendar.setTime( data_documento );
        //adicionar 15 dias na data do documento.

        calendar.add( Calendar.DATE, prazo_proforma );
        venda_local.setDataVencimento( calendar.getTime() );
        venda_local.setHora( data_documento );
        venda_local.setNomeCliente( getNomeCliente() );

        venda_local.setClienteNif( getClienteNif() );

        //Total Ilíquido
        venda_local.setTotalGeral( new BigDecimal( "0.0" ) );
        //desconto por linha
        venda_local.setDescontoComercial( new BigDecimal( "0.0" ) );
        //imposto
        //calculaTotalIVA();
        venda_local.setTotalIva( new BigDecimal( "0.0" ) );
        //calculaTotalRetencao();
        venda_local.setTotalRetencao( new BigDecimal( "0.0" ) );
        //desconto global
        venda_local.setDescontoFinanceiro( new BigDecimal( "0.0" ) );
        //Total(AOA) <=> Total Líquido
        venda_local.setTotalVenda( new BigDecimal( "0.0" ) );
        venda_local.setValorEntregue( new BigDecimal( "0.0" ) );
        venda_local.setTroco( new BigDecimal( "0.0" ) );
        venda_local.setTotalIncidencia( new BigDecimal( "0.0" ) );
        venda_local.setTotalIncidenciaIsento( new BigDecimal( "0.0" ) );
        /*outros campos*/

        venda_local.setDescontoTotal( new BigDecimal( "0.0" ) );
        venda_local.setIdBanco( new TbBanco( 1 ) );
        venda_local.setIdArmazemFK( new TbArmazem( 2 ) );
        venda_local.setCodigoUsuario( new TbUsuario( idUser ) );
        venda_local.setCodigoCliente( new TbCliente( cliente.getCodigo() ) );
        venda_local.setFkAnoEconomico( venda.getFkAnoEconomico() );
        venda_local.setReferencia( "" );
        venda_local.setNomeConsumidorFinal( cliente.getNome() );
        venda_local.setFkDocumento( documento );
        venda_local.setCodFact( prox_doc );
        venda_local.setCont( 0 );
        //this.prox_doc = !vendaDao.existe_codFact( prox_doc, conexao ) ? prox_doc : getCodDocActualizador();
//        venda_local.setCodFact( getCodDocActualizador() );

//        venda_local.setHashCod( MetodosUtil.criptografia_hash( prox_doc ) );
        venda_local.setHashCod( MetodosUtil.criptografia_hash( venda_local, 0d, conexao ) );

        venda_local.setTotalPorExtenso( "" );

        venda_local.setNomeMotorista( "" );
        
        venda_local.setNumChassi( venda_original.getNumChassi() );
        venda_local.setMatricula( venda_original.getMatricula() );
        venda_local.setMarcaCarro( venda_original.getMarcaCarro() );
        venda_local.setModelo( venda_original.getModelo());
        venda_local.setCorCarro( venda_original.getCorCarro());
        venda_local.setKilometro( venda_original.getKilometro() );
        venda_local.setNumMotor( venda_original.getNumMotor());
        venda_local.setNDocMotorista(venda_original.getNDocMotorista());
        venda_local.setObs( "" );
        System.out.println( "STATUS:hash cod processado." );

        // venda_local.setAssinatura( this.prox_doc );
        venda_local.setAssinatura( MetodosUtil.assinatura_doc( venda_local.getHashCod() ) );
//        venda_local.setRefDataFact( CfMethods.fullDateToText( venda_local.getDataVenda() ) );

        //System.out.println( "STATUS:documento assinado com sucesso." );
        venda_local.setFkCambio( new Cambio( 1 ) );

        /*status documento*/
        venda_local.setStatusEliminado( "false" );
        venda_local.setPerformance( "false" );
        venda_local.setCredito( "false" );
        venda_local.setGorjeta( new BigDecimal( 0d ) );

        try
        {

            if ( vendasController.salvar( venda_local ) )
            {
                DocumentosController.commit( conexaoTransaction );
                Integer last_venda = vendasController.getLastVenda().getCodigo();

                if ( Objects.isNull( last_venda ) || last_venda == 0 )
                {
                    DocumentosController.rollback(conexaoTransaction );
                    conexaoTransaction.close();
                    return 0;
                }
                System.err.println( "last_venda: " + last_venda );
                System.out.println( "STATUS:factura criada com sucesso." );
                return last_venda;
            }
            else
            {
                System.out.println( "ERROR: Já existe venda relacionada." );
            }

        }
        catch ( Exception e )
        {
            System.err.println( "STATUS: falha ao actualizar a factura" );
            e.printStackTrace();
            JOptionPane.showMessageDialog( null, "Falha ao Processar a Factura", "FALHA", JOptionPane.ERROR_MESSAGE );
            DocumentosController.rollback(conexaoTransaction );
            conexaoTransaction.close();
        }

        return 0;

    }

    public static TbVenda getVenda()
    {
        codFactura = txtRef.getText();
        //String codFactura = (String) cmbFactura.getSelectedItem();
        return new VendaDao( emf ).findByCodFact( codFactura );
        
    }

    private String getNomeCliente()
    {
        return cliente.getNome();
    }

    private String getClienteNif()
    {
        return cliente.getNif();
    }

    private void mostrar_proximo_codigo_documento()
    {
        try
        {
            documento = (Documento) documentosController.findById( getIdDocumento() );
            anoEconomico = (AnoEconomico) anoEconomicoController.findById( getIdAnoEconomico() );
            doc_prox_cod = vendasController.getUltimaContagemByIdDocumentoAndAnoEconomico(
                    getIdDocumento(), getIdAnoEconomico() ) + 1;
            prox_doc = documento.getAbreviacao();
            //FA Série / codigo
            prox_doc += " " + anoEconomico.getSerie() + "/" + doc_prox_cod;
            jLabel1.setText( "VISTORIA N:" + prox_doc );
        }
        catch ( Exception e )
        {
            documento = null;
            jLabel1.setText( "VISTORIA " );
        }
    }

    private int getIdDocumento()
    {
        return DVML.DOC_VISTORIA;
    }

    public int getIdAnoEconomico()
    {
        try
        {
            AnoEconomico anoEconomicoLocal = anoEconomicoController
                    .getAnoEconomicoByDesignacao( cmbAnoEconomico.getSelectedItem().toString() );
            return anoEconomicoLocal.getPkAnoEconomico();
        }
        catch ( Exception e )
        {
            return 0;
        }
    }

    private void report( int lastVenda )
    {
        HashMap hashMap = new HashMap();
        hashMap.put( "PARM_COD_VENDA", lastVenda );
        String file = "vistoria.jasper";
        AnyReport anyReport = new AnyReport( hashMap, file );
    }

}
