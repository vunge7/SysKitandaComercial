/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package visao;


import java.sql.Connection;
import dao.ClienteDao;
import dao.ItemVendaDao;
import dao.UsuarioDao;
import dao.VendaDao;
import entity.TbCliente;
import entity.TbItemVenda;
import entity.TbVenda;
import java.text.DecimalFormat;
import java.util.Date;
import java.util.List;
import javax.persistence.EntityManagerFactory;
import javax.swing.DefaultListModel;
import javax.swing.JFormattedTextField;
import javax.swing.JList;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;
import javax.swing.text.DefaultFormatterFactory;
import javax.swing.text.NumberFormatter;
import lista.ListaVenda;
import util.DVML.Abreviacao;
import util.JPAEntityMannagerFactoryUtil;
import util.MetodosUtil;

/**
 *
 * @author Domingos Dala Vunge
 */
public class GestaoCreditos extends javax.swing.JFrame
{

    private static EntityManagerFactory emf = JPAEntityMannagerFactoryUtil.em;
    private static DefaultListModel lista_clientes = new DefaultListModel();
    public static DefaultListModel lista_vendas = new DefaultListModel();
    private TbCliente cliente;
    private static ClienteDao clienteDao = new ClienteDao( emf );
    private UsuarioDao usuarioDao = new UsuarioDao( emf );
    private static ItemVendaDao itemVendaDao = new ItemVendaDao( emf );
    private static VendaDao vendaDao = new VendaDao( emf );
    private TbVenda venda;
//    private static String idVenda = "";
    private static String codFact = "";
    private int id_user = 0;
    private int id_cliente = 0;
    public static Abreviacao abreviacao;

    public GestaoCreditos( int id_user )
    {
        initComponents();
        setLocationRelativeTo( null );
        this.id_user = id_user;
        mascara();
        adiciona_lista_clientes();
        jListVendasCreditos.setModel( lista_vendas );
        JListClientes.setModel( lista_clientes );

    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents()
    {

        painel = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        JListClientes = new javax.swing.JList<>();
        jScrollPane2 = new javax.swing.JScrollPane();
        jListVendasCreditos = new javax.swing.JList<>();
        jPanel1 = new javax.swing.JPanel();
        jScrollPane3 = new javax.swing.JScrollPane();
        tabela_detalhes = new javax.swing.JTable();
        jLabel2 = new javax.swing.JLabel();
        jLabel1 = new javax.swing.JLabel();
        lbCliente = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        lbFactura = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        ckImpreesao = new javax.swing.JCheckBox();
        lb_armazem = new javax.swing.JLabel();
        form_txt_total_venda_factura = new javax.swing.JFormattedTextField();
        jLabel5 = new javax.swing.JLabel();
        form_txt_total_geral_factura = new javax.swing.JFormattedTextField();
        jLabel6 = new javax.swing.JLabel();
        form_txt_desconto_factura = new javax.swing.JFormattedTextField();
        jLabel7 = new javax.swing.JLabel();
        jPanel2 = new javax.swing.JPanel();
        jButton1 = new javax.swing.JButton();
        jButton2 = new javax.swing.JButton();
        form_txt_total_geral = new javax.swing.JFormattedTextField();
        form_txt_total_geral_cliente = new javax.swing.JFormattedTextField();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("Formulário de Créditos");

        painel.setBorder(javax.swing.BorderFactory.createTitledBorder("Pagamentos de Facturas em Crédito"));

        JListClientes.setBorder(javax.swing.BorderFactory.createTitledBorder("Clientes"));
        JListClientes.addMouseListener(new java.awt.event.MouseAdapter()
        {
            public void mouseClicked(java.awt.event.MouseEvent evt)
            {
                JListClientesMouseClicked(evt);
            }
        });
        JListClientes.addKeyListener(new java.awt.event.KeyAdapter()
        {
            public void keyPressed(java.awt.event.KeyEvent evt)
            {
                JListClientesKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt)
            {
                JListClientesKeyReleased(evt);
            }
        });
        jScrollPane1.setViewportView(JListClientes);

        jListVendasCreditos.setBorder(javax.swing.BorderFactory.createTitledBorder("Facturas"));
        jListVendasCreditos.addMouseListener(new java.awt.event.MouseAdapter()
        {
            public void mouseClicked(java.awt.event.MouseEvent evt)
            {
                jListVendasCreditosMouseClicked(evt);
            }
        });
        jListVendasCreditos.addKeyListener(new java.awt.event.KeyAdapter()
        {
            public void keyReleased(java.awt.event.KeyEvent evt)
            {
                jListVendasCreditosKeyReleased(evt);
            }
        });
        jScrollPane2.setViewportView(jListVendasCreditos);

        jPanel1.setBackground(new java.awt.Color(153, 153, 153));
        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder("Factura por Pagar"));

        tabela_detalhes.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][]
            {

            },
            new String []
            {
                "Cod", "Designação", "Preço", "Qtd", "Total"
            }
        )
        {
            Class[] types = new Class []
            {
                java.lang.Object.class, java.lang.Object.class, java.lang.Double.class, java.lang.Integer.class, java.lang.Double.class
            };
            boolean[] canEdit = new boolean []
            {
                false, false, false, false, false
            };

            public Class getColumnClass(int columnIndex)
            {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex)
            {
                return canEdit [columnIndex];
            }
        });
        jScrollPane3.setViewportView(tabela_detalhes);
        if (tabela_detalhes.getColumnModel().getColumnCount() > 0)
        {
            tabela_detalhes.getColumnModel().getColumn(0).setMaxWidth(100);
            tabela_detalhes.getColumnModel().getColumn(2).setMaxWidth(200);
            tabela_detalhes.getColumnModel().getColumn(3).setMaxWidth(160);
            tabela_detalhes.getColumnModel().getColumn(4).setMaxWidth(200);
        }

        jLabel2.setFont(new java.awt.Font("Lucida Grande", 1, 20)); // NOI18N
        jLabel2.setText("Total a Pagar :");

        jLabel1.setText("Nome Cliente :");

        lbCliente.setFont(new java.awt.Font("Lucida Grande", 1, 18)); // NOI18N
        lbCliente.setForeground(new java.awt.Color(204, 0, 51));
        lbCliente.setText(".");

        jLabel3.setText("Documento Nº.");

        lbFactura.setFont(new java.awt.Font("Lucida Grande", 1, 18)); // NOI18N
        lbFactura.setForeground(new java.awt.Color(204, 0, 51));
        lbFactura.setText(".");

        jLabel4.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagens/1323444801_currency_dollar red.png"))); // NOI18N

        ckImpreesao.setSelected(true);
        ckImpreesao.setText("A4");

        lb_armazem.setText("ARMAZÉM");

        form_txt_total_venda_factura.setEditable(false);
        form_txt_total_venda_factura.setBackground(new java.awt.Color(0, 0, 0));
        form_txt_total_venda_factura.setForeground(new java.awt.Color(255, 255, 255));
        form_txt_total_venda_factura.setFont(new java.awt.Font("Lucida Grande", 1, 22)); // NOI18N
        form_txt_total_venda_factura.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                form_txt_total_venda_facturaActionPerformed(evt);
            }
        });

        jLabel5.setFont(new java.awt.Font("Lucida Grande", 1, 20)); // NOI18N
        jLabel5.setText("Desconto:");

        form_txt_total_geral_factura.setEditable(false);
        form_txt_total_geral_factura.setBackground(new java.awt.Color(0, 0, 0));
        form_txt_total_geral_factura.setForeground(new java.awt.Color(255, 255, 255));
        form_txt_total_geral_factura.setFont(new java.awt.Font("Lucida Grande", 1, 22)); // NOI18N
        form_txt_total_geral_factura.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                form_txt_total_geral_facturaActionPerformed(evt);
            }
        });

        jLabel6.setFont(new java.awt.Font("Lucida Grande", 1, 20)); // NOI18N
        jLabel6.setText("Total Geral:");

        form_txt_desconto_factura.setEditable(false);
        form_txt_desconto_factura.setBackground(new java.awt.Color(0, 0, 0));
        form_txt_desconto_factura.setForeground(new java.awt.Color(255, 255, 255));
        form_txt_desconto_factura.setFont(new java.awt.Font("Lucida Grande", 1, 22)); // NOI18N
        form_txt_desconto_factura.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                form_txt_desconto_facturaActionPerformed(evt);
            }
        });

        jLabel7.setFont(new java.awt.Font("Lucida Grande", 1, 20)); // NOI18N
        jLabel7.setText("%");

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane3, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addContainerGap()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addComponent(ckImpreesao)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addComponent(lb_armazem))
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                    .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanel1Layout.createSequentialGroup()
                                        .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 159, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addGap(18, 18, 18)
                                        .addComponent(form_txt_total_venda_factura))
                                    .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanel1Layout.createSequentialGroup()
                                        .addComponent(jLabel6, javax.swing.GroupLayout.DEFAULT_SIZE, 159, Short.MAX_VALUE)
                                        .addGap(18, 18, 18)
                                        .addComponent(form_txt_total_geral_factura, javax.swing.GroupLayout.PREFERRED_SIZE, 265, javax.swing.GroupLayout.PREFERRED_SIZE)))
                                .addGap(206, 206, 206))
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(jLabel1)
                                    .addComponent(jLabel3))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addGroup(jPanel1Layout.createSequentialGroup()
                                        .addComponent(lbFactura, javax.swing.GroupLayout.PREFERRED_SIZE, 331, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                        .addComponent(jLabel4))
                                    .addComponent(lbCliente, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))))))
                .addContainerGap())
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel5, javax.swing.GroupLayout.PREFERRED_SIZE, 159, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(form_txt_desconto_factura, javax.swing.GroupLayout.PREFERRED_SIZE, 75, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jLabel7, javax.swing.GroupLayout.PREFERRED_SIZE, 24, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(ckImpreesao)
                    .addComponent(lb_armazem))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jLabel3)
                        .addComponent(lbFactura, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(jLabel4))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel1)
                    .addComponent(lbCliente, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 279, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(form_txt_total_geral_factura)
                    .addComponent(jLabel6, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel7, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 41, Short.MAX_VALUE)
                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jLabel5)
                        .addComponent(form_txt_desconto_factura)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 38, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(form_txt_total_venda_factura))
                .addGap(15, 15, 15))
        );

        jButton1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagens/pauta academica 32x32.png"))); // NOI18N
        jButton1.setText("Amortizar");
        jButton1.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                jButton1ActionPerformed(evt);
            }
        });

        jButton2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagens/LOGOUT - VERMELHO/Logout 32x32.png"))); // NOI18N
        jButton2.setText("Saír");
        jButton2.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                jButton2ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addGap(17, 17, 17)
                .addComponent(jButton1, javax.swing.GroupLayout.PREFERRED_SIZE, 185, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jButton2)
                .addContainerGap())
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jButton1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jButton2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );

        form_txt_total_geral.setEditable(false);
        form_txt_total_geral.setBackground(new java.awt.Color(0, 0, 0));
        form_txt_total_geral.setForeground(new java.awt.Color(255, 255, 255));
        form_txt_total_geral.setFont(new java.awt.Font("Lucida Grande", 1, 25)); // NOI18N
        form_txt_total_geral.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                form_txt_total_geralActionPerformed(evt);
            }
        });

        form_txt_total_geral_cliente.setEditable(false);
        form_txt_total_geral_cliente.setBackground(new java.awt.Color(0, 0, 0));
        form_txt_total_geral_cliente.setForeground(new java.awt.Color(255, 255, 255));
        form_txt_total_geral_cliente.setFont(new java.awt.Font("Lucida Grande", 1, 25)); // NOI18N
        form_txt_total_geral_cliente.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                form_txt_total_geral_clienteActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout painelLayout = new javax.swing.GroupLayout(painel);
        painel.setLayout(painelLayout);
        painelLayout.setHorizontalGroup(
            painelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, painelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(painelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(form_txt_total_geral)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 230, Short.MAX_VALUE))
                .addGroup(painelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(painelLayout.createSequentialGroup()
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE))
                    .addGroup(painelLayout.createSequentialGroup()
                        .addGap(8, 8, 8)
                        .addComponent(form_txt_total_geral_cliente, javax.swing.GroupLayout.DEFAULT_SIZE, 231, Short.MAX_VALUE)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(painelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );
        painelLayout.setVerticalGroup(
            painelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(painelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(painelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jScrollPane1)
                    .addComponent(jScrollPane2))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(painelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(painelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(form_txt_total_geral_cliente, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(form_txt_total_geral, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(painel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(painel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents


    private void JListClientesMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_JListClientesMouseClicked
        busca_factura_por_cliente();
        procedimento_limpar_dados();


    }//GEN-LAST:event_JListClientesMouseClicked


    private void jListVendasCreditosMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jListVendasCreditosMouseClicked
        adicionar_tabela( jListVendasCreditos );
    }//GEN-LAST:event_jListVendasCreditosMouseClicked

    private void jButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton2ActionPerformed
        dispose();
    }//GEN-LAST:event_jButton2ActionPerformed

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed

        
        new AmortizacaoVisao( this.id_user, codFact ).setVisible( true );

    }//GEN-LAST:event_jButton1ActionPerformed

    private void form_txt_total_geralActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_form_txt_total_geralActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_form_txt_total_geralActionPerformed

    private void form_txt_total_geral_clienteActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_form_txt_total_geral_clienteActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_form_txt_total_geral_clienteActionPerformed

    private void JListClientesKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_JListClientesKeyPressed
        // TODO add your handling code here:

    }//GEN-LAST:event_JListClientesKeyPressed

    private void JListClientesKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_JListClientesKeyReleased
        // TODO add your handling code here:
        busca_factura_por_cliente();
    }//GEN-LAST:event_JListClientesKeyReleased

    private void form_txt_total_venda_facturaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_form_txt_total_venda_facturaActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_form_txt_total_venda_facturaActionPerformed

    private void jListVendasCreditosKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jListVendasCreditosKeyReleased
        // TODO add your handling code here:
        adicionar_tabela( jListVendasCreditos );
    }//GEN-LAST:event_jListVendasCreditosKeyReleased

    private void form_txt_total_geral_facturaActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_form_txt_total_geral_facturaActionPerformed
    {//GEN-HEADEREND:event_form_txt_total_geral_facturaActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_form_txt_total_geral_facturaActionPerformed

    private void form_txt_desconto_facturaActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_form_txt_desconto_facturaActionPerformed
    {//GEN-HEADEREND:event_form_txt_desconto_facturaActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_form_txt_desconto_facturaActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main( String args[] )
    {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try
        {
            for ( javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels() )
            {
                if ( "Windows".equals( info.getName() ) )
                {
                    javax.swing.UIManager.setLookAndFeel( info.getClassName() );
                    break;
                }
            }
        }
        catch ( ClassNotFoundException ex )
        {
            java.util.logging.Logger.getLogger( GestaoCreditos.class.getName() ).log( java.util.logging.Level.SEVERE, null, ex );
        }
        catch ( InstantiationException ex )
        {
            java.util.logging.Logger.getLogger( GestaoCreditos.class.getName() ).log( java.util.logging.Level.SEVERE, null, ex );
        }
        catch ( IllegalAccessException ex )
        {
            java.util.logging.Logger.getLogger( GestaoCreditos.class.getName() ).log( java.util.logging.Level.SEVERE, null, ex );
        }
        catch ( javax.swing.UnsupportedLookAndFeelException ex )
        {
            java.util.logging.Logger.getLogger( GestaoCreditos.class.getName() ).log( java.util.logging.Level.SEVERE, null, ex );
        }
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable()
        {
            public void run()
            {
                new GestaoCreditos( 15 ).setVisible( true );
            }
        } );
    }


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private static javax.swing.JList<String> JListClientes;
    private javax.swing.JCheckBox ckImpreesao;
    private static javax.swing.JFormattedTextField form_txt_desconto_factura;
    private static javax.swing.JFormattedTextField form_txt_total_geral;
    private static javax.swing.JFormattedTextField form_txt_total_geral_cliente;
    private static javax.swing.JFormattedTextField form_txt_total_geral_factura;
    private static javax.swing.JFormattedTextField form_txt_total_venda_factura;
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton2;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    public static javax.swing.JList<String> jListVendasCreditos;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane3;
    private static javax.swing.JLabel lbCliente;
    private static javax.swing.JLabel lbFactura;
    private static javax.swing.JLabel lb_armazem;
    private javax.swing.JPanel painel;
    private static javax.swing.JTable tabela_detalhes;
    // End of variables declaration//GEN-END:variables

    public static void busca_factura_por_cliente()
    {

        try
        {
            List<TbVenda> lista = clienteDao.getAllVendasByClientes( getIdCliente() );
            lista_vendas.clear();
            for ( int i = 0; i < lista.size(); i++ )
            {
                lista_vendas.addElement( lista.get( i ).getCodFact() + "--- " + lista.get( i ).getDataVenda().getDate() + "/" + ( lista.get( i ).getDataVenda().getMonth() + 1 ) + "/" + ( 1900 + lista.get( i ).getDataVenda().getYear() ) );
            }
            mostrar_total_geral_cliente();

        }
        catch ( Exception e )
        {
            form_txt_total_geral_cliente.setText( "0" );
            //e.printStackTrace();

        }

    }

    private static void apagar_dados_tabela()
    {
        DefaultTableModel modelo = (DefaultTableModel) tabela_detalhes.getModel();
        modelo.setRowCount( 0 );

    }

    private void procedimento_actualizar_factura()
    {

        try
        {
            venda = vendaDao.findTbVenda( Integer.parseInt( codFact ) );
            setDadosVendas();
            vendaDao.edit( venda );
            procedimento_limpar_dados();
            mostrar_total_geral();
            mostrar_total_geral_cliente();
            busca_factura_por_cliente();

            JOptionPane.showMessageDialog( null, "Pagamento efectuado com sucesso!..." );
//            VER
            ListaVenda listaVenda = new ListaVenda( venda.getCodigo(), abreviacao, false, ckImpreesao.isSelected(), "Original");
        }
        catch ( Exception e )
        {
            e.printStackTrace();
            JOptionPane.showMessageDialog( null, "Erro ao executar a Venda ", "ERRO", JOptionPane.ERROR_MESSAGE );
        }

    }

    public static void mostrar_total_geral()
    {
        try
        {
            double total = vendaDao.getAllEncomenda();

            form_txt_total_geral.setText( MetodosUtil.getValorTransformadoString( total ) );
        }
        catch ( Exception e )
        {
            form_txt_total_geral.setText( "0" );
        }

    }

    public static void mostrar_total_geral_cliente()
    {

        try
        {
            double total = vendaDao.getAllEncomendaByCliente( getIdCliente() );
            form_txt_total_geral_cliente.setText( MetodosUtil.getValorTransformadoString( total ) );
        }
        catch ( Exception e )
        {
            form_txt_total_geral_cliente.setText( "0" );
        }

    }

    public static void adiciona_lista_clientes()
    {

        try
        {

            List<TbCliente> lista_de_clientes = vendaDao.getAllClienteDevedoresFactura();
            lista_clientes.clear();
            for ( int i = 0; i < lista_de_clientes.size(); i++ )
            {
                lista_clientes.addElement( lista_de_clientes.get( i ).getNome() );
            }
            mostrar_total_geral();

        }
        catch ( Exception e )
        {
            e.printStackTrace();
        }

    }

    private void mascara()
    {

        try
        {

            DecimalFormat decimalFormat = new DecimalFormat( "#,###,###.00" );
            NumberFormatter numberFormatter = new NumberFormatter( decimalFormat );
            numberFormatter.setFormat( decimalFormat );
            numberFormatter.setAllowsInvalid( false );
            JFormattedTextField ft = new JFormattedTextField();
            form_txt_total_geral.setFormatterFactory( new DefaultFormatterFactory( numberFormatter ) );

        }
        catch ( Exception e )
        {
        }

        try
        {

            DecimalFormat decimalFormat = new DecimalFormat( "#,###,###.00" );
            NumberFormatter numberFormatter = new NumberFormatter( decimalFormat );
            numberFormatter.setFormat( decimalFormat );
            numberFormatter.setAllowsInvalid( false );
            JFormattedTextField ft = new JFormattedTextField();
            form_txt_total_geral_cliente.setFormatterFactory( new DefaultFormatterFactory( numberFormatter ) );

        }
        catch ( Exception e )
        {
        }

        try
        {

            DecimalFormat decimalFormat = new DecimalFormat( "#,###,###.00" );
            NumberFormatter numberFormatter = new NumberFormatter( decimalFormat );
            numberFormatter.setFormat( decimalFormat );
            numberFormatter.setAllowsInvalid( false );
            JFormattedTextField ft = new JFormattedTextField();
            form_txt_total_geral_factura.setFormatterFactory( new DefaultFormatterFactory( numberFormatter ) );

        }
        catch ( Exception e )
        {
        }
        try
        {

            DecimalFormat decimalFormat = new DecimalFormat( "#,###,###.00" );
            NumberFormatter numberFormatter = new NumberFormatter( decimalFormat );
            numberFormatter.setFormat( decimalFormat );
            numberFormatter.setAllowsInvalid( false );
            JFormattedTextField ft = new JFormattedTextField();
            form_txt_desconto_factura.setFormatterFactory( new DefaultFormatterFactory( numberFormatter ) );

        }
        catch ( Exception e )
        {
        }
        try
        {

            DecimalFormat decimalFormat = new DecimalFormat( "#,###,###.00" );
            NumberFormatter numberFormatter = new NumberFormatter( decimalFormat );
            numberFormatter.setFormat( decimalFormat );
            numberFormatter.setAllowsInvalid( false );
            JFormattedTextField ft = new JFormattedTextField();
            form_txt_total_venda_factura.setFormatterFactory( new DefaultFormatterFactory( numberFormatter ) );

        }
        catch ( Exception e )
        {
        }

    }

    public static void procedimento_limpar_dados()
    {
        lbFactura.setText( "" );
        lbCliente.setText( "" );
        lb_armazem.setText( "" );
        codFact = "";
        form_txt_total_venda_factura.setText( "0" );
        form_txt_total_geral_factura.setText( "0" );
        form_txt_desconto_factura.setText( "0" );
        codFact = "";
        apagar_dados_tabela();

    }

    private int getIdVenda( JList jlista )
    {
        try
        {
            String descricao = jlista.getSelectedValue().toString();
            int numero = descricao.lastIndexOf( "--- " );
            System.out.println( "ID " + descricao.substring( 0, numero ) );
            this.codFact = descricao.substring( 0, numero );
            return Integer.parseInt( descricao.substring( 0, numero ) );
        }
        catch ( Exception e )
        {
            return 0;
        }

    }

    private String getIdCodFact( JList jlista )
    {
        try
        {
            String descricao = jlista.getSelectedValue().toString();
            int numero = descricao.lastIndexOf( "--- " );
            System.out.println( "ID " + descricao.substring( 0, numero ) );
            this.codFact = descricao.substring( 0, numero );
            return descricao.substring( 0, numero );
        }
        catch ( Exception e )
        {
            return "";
        }

    }

    public void setDadosVendas()
    {

        this.venda.setCredito( "false" );
        this.venda.setDataVenda( new Date() );
        // this.venda.setCodigoUsuario(this.usuarioDao.findUsuario( this.id_user ) );

    }

    private static int getIdCliente()
    {
        // this.id_cliente = clienteDao.getIdByDescricao(String.valueOf(JListClientes.getSelectedValue() ) );  
        return clienteDao.getIdByDescricao( String.valueOf( JListClientes.getSelectedValue() ) );
    }

    public void alterar()
    {

        if ( this.codFact.equals( "" ) )
        {

            int opcao = JOptionPane.showConfirmDialog( null, "Tens a certeza que pretendes pagar essa factura ?" );
            if ( opcao == JOptionPane.YES_OPTION )
            {
                procedimento_actualizar_factura();
            }

        }
        else
        {
            JOptionPane.showMessageDialog( null, "Não existe factura seleccionada para pagar.", "INFO", JOptionPane.INFORMATION_MESSAGE );
        }
    }

    public void adicionar_tabela( JList jLista )
    {

        DefaultTableModel modelo = (DefaultTableModel) tabela_detalhes.getModel();

        try
        {

//            List<TbItemVenda> list = itemVendaDao.itens_venda_by_id( getIdVenda( jLista ) );
            List<TbItemVenda> list = itemVendaDao.itens_venda_by_id( getIdCodFact( jLista ) );
            TbVenda venda_local = list.get( 0 ).getCodigoVenda();
            modelo.setRowCount( 0 );
            for ( int i = 0; i < list.size(); i++ )
            {

                TbItemVenda get = list.get( i );
                modelo.addRow( new Object[]
                {

                    get.getCodigoProduto().getCodigo(),
                    get.getCodigoProduto().getDesignacao(),
                    get.getFkPreco().getPrecoVenda(),
                    get.getQuantidade(),
                    get.getTotal()

                } );

            }

            System.out.println( "Total Geral: " + venda_local.getTotalGeral() );
            form_txt_total_geral_factura.setText( MetodosUtil.getValorTransformadoString( venda_local.getTotalGeral().doubleValue() ) );
            form_txt_desconto_factura.setText( MetodosUtil.getValorTransformadoString( venda_local.getDescontoTotal().doubleValue() ) );
            form_txt_total_venda_factura.setText( MetodosUtil.getValorTransformadoString( venda_local.getTotalVenda().doubleValue() ) );
            lb_armazem.setText( venda_local.getIdArmazemFK().getDesignacao() );

            lbCliente.setText( venda_local.getNomeCliente() );
            lbFactura.setText( venda_local.getCodFact() );

            //procedimento_mostra_total();
        }
        catch ( Exception e )
        {
            e.printStackTrace();
        }

    }

}
